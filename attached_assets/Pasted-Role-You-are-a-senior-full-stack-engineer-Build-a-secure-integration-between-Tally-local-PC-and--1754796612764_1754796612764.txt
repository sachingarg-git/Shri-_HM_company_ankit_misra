Role: You are a senior full-stack engineer. Build a secure integration between Tally (local PC) and my Replit web app using a Local Connector (Windows service) that pushes data to a cloud API.

Architecture
Local Connector (Windows, .NET 8 C# console → Windows Service) talks to Tally XML/HTTP at http://{TALLY_HOST}:{TALLY_PORT} (default 9000).

Connector pulls Companies, Ledgers, Stock Items, Vouchers (date range) and pushes JSON deltas over HTTPS to the Replit API.

Replit Web API (Node.js + Express + PostgreSQL/Prisma) stores data and shows sync status.

Deliverables
A) Replit Web API (Node/Express)
Scaffold project with:

/api/tally/push (POST, Auth via x-api-key)

/api/tally/status (GET: last sync times, counts, latest errors per company)

/api/companies/:id/ledgers, /items, /vouchers (GET, paginated)

Prisma schema (PostgreSQL):

Company(id uuid pk, name, gstin, externalId, apiKey hashed, createdAt)

Ledger(id, companyId fk, name, groupName, closingBalance, modifiedAt, raw jsonb)

StockItem(id, companyId fk, name, unit, opening, closing, modifiedAt, raw jsonb)

Voucher(id, companyId fk, voucherType, number, date, party, amount, modifiedAt, raw jsonb, hash unique)

SyncLog(id, companyId, entity, receivedAt, count, okCount, errorCount, notes)

Logic

Validate x-api-key → map to Company.

Upsert by natural keys; for vouchers, dedupe by hash(companyId+voucherType+number+date+amount).

Bulk insert with transaction + partial failure handling; return {accepted, failed, errors[]}.

Keep raw JSON for future reconciliation.

Config

.env: DATABASE_URL, ADMIN_KEY, JWT_SECRET (reserved), RATE_LIMIT.

Add simple rate-limit (100 req/min per company).

Utilities

Logger (pino) + request id.

Health: GET /health returns versions and DB ping result.

Docs & Tests

Auto-generate OpenAPI (swagger-ui at /docs).

Postman collection + example curl for /api/tally/push.

B) Windows Local Connector (.NET 8 C#)
Console app that can be installed as Windows Service.

appsettings.json:

json
Copy
Edit
{
  "Tally": { "Host": "localhost", "Port": 9000, "Company": "", "PollMinutes": 15 },
  "Cloud": { "BaseUrl": "https://<REPLIT-URL>", "ApiKey": "<PLACEHOLDER>", "TimeoutSec": 60 },
  "State": { "Path": "%PROGRAMDATA%/Wizone/TallyConnector/state.json" },
  "Retry": { "MaxAttempts": 5, "BaseDelayMs": 1000 }
}
Modules:

TallyClient (HTTP XML) with helpers to send XML envelopes and parse to POCOs.

Mappers from Tally XML → JSON payloads for companies, ledgers, items, vouchers.

DeltaEngine storing LastSync per entity; next run uses date window + overlap (e.g., last 2 days).

CloudClient POST /api/tally/push with backoff + offline queue (disk).

Scheduler to run every PollMinutes.

Structured logging to file: %PROGRAMDATA%/Wizone/TallyConnector/logs.

Sample Tally XML (implement as embedded strings):

Companies

xml
Copy
Edit
<ENVELOPE><HEADER><TALLYREQUEST>Export Data</TALLYREQUEST></HEADER><BODY><EXPORTDATA><REQUESTDESC><REPORTNAME>List of Companies</REPORTNAME><STATICVARIABLES><SVEXPORTFORMAT>$$SysName:XML</SVEXPORTFORMAT></STATICVARIABLES></REQUESTDESC></EXPORTDATA></BODY></ENVELOPE>
Ledgers

xml
Copy
Edit
<ENVELOPE><HEADER><TALLYREQUEST>Export Data</TALLYREQUEST></HEADER><BODY><EXPORTDATA><REQUESTDESC><REPORTNAME>Ledger Masters</REPORTNAME><STATICVARIABLES><SVEXPORTFORMAT>$$SysName:XML</SVEXPORTFORMAT></STATICVARIABLES></REQUESTDESC></EXPORTDATA></BODY></ENVELOPE>
Vouchers (date range) — parameters from, to.

Installer scripts

install-service.ps1: publish self-contained win-x64, create folder, write config, sc create "TallyConnector" binPath= "<path>\TallyConnector.exe" start= auto.

uninstall-service.ps1: stop & delete service.

Diagnostics

--test-connection CLI flag: ping Tally endpoint and print diagnostics.

--push-sample to send a small mocked payload to the cloud.

C) End-to-End Demo
Seed one Company with generated apiKey and print it in server logs.

Provide a README with:

Tally settings required: “Enable Web Server = Yes”, “Accept Local Connections = Yes”, “Enable ODBC/XML server on port 9000”, firewall allow.

How to run API on Replit, run migrations, and open Swagger.

How to publish and install the Windows service.

Postman tests and expected responses.

Non-functional Requirements
Idempotent upserts, safe retries.

Never expose Tally port to the internet.

Validate payload sizes (chunk up to 5,000 records).

Timezone IST handling and ISO 8601 timestamps.

Code comments and clean folder structure.

Success Criteria
GET /health = OK.

Posting sample ledgers/vouchers returns {accepted > 0, failed = 0}.

/api/tally/status shows last sync timestamps and counts.

Connector runs 15-min polling, logs successes, and survives reboots.

Now generate:

Full Replit Node/Express project with Prisma schema and routes above.

.NET 8 connector solution with all modules, sample XML calls, and installer scripts.

README, .env.example, Swagger docs, and Postman collection.

Commands to run locally and on Replit.

